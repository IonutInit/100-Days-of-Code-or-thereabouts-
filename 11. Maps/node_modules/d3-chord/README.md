# d3-chord

Visualize relationships or network flow with an aesthetically-pleasing circular layout.

[![Chord Diagram](https://raw.githubusercontent.com/d3/d3-chord/master/img/chord.png)](https://observablehq.com/@d3/chord-diagram)

## Installing

If you use npm, `npm install d3-chord`. You can also download the [latest release on GitHub](https://github.com/d3/d3-chord/releases/latest). For vanilla HTML in modern browsers, import d3-chord from Skypack:

```html
<script type="module">

import {chord} from "https://cdn.skypack.dev/d3-chord@3";

const c = chord();

</script>
```

For legacy environments, you can load d3-chord’s UMD bundle from an npm-based CDN such as jsDelivr; a `d3` global is exported:

```html
<script src="https://cdn.jsdelivr.net/npm/d3-path@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-chord@3"></script>
<script>

const chord = d3.chord();

</script>
```

## API Reference

[#](./#chord) d3.chord() · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

Constructs a new chord layout with the default settings.

[#](./#\_chord) _chord_(_matrix_) · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

Computes the chord layout for the specified square _matrix_ of size _n_×_n_, where the _matrix_ represents the directed flow amongst a network (a complete digraph) of _n_ nodes. The given _matrix_ must be an array of length _n_, where each element _matrix_\[_i_] is an array of _n_ numbers, where each _matrix_\[_i_]\[_j_] represents the flow from the _i_th node in the network to the _j_th node. Each number _matrix_\[_i_]\[_j_] must be nonnegative, though it can be zero if there is no flow from node _i_ to node _j_. From the [Circos tableviewer example](http://mkweb.bcgsc.ca/circos/guide/tables/):

```js
const matrix = [
  [11975,  5871, 8916, 2868],
  [ 1951, 10048, 2060, 6171],
  [ 8010, 16145, 8090, 8045],
  [ 1013,   990,  940, 6907]
];
```

The return value of _chord_(_matrix_) is an array of _chords_, where each chord represents the combined bidirectional flow between two nodes _i_ and _j_ (where _i_ may be equal to _j_) and is an object with the following properties:

* `source` - the source subgroup
* `target` - the target subgroup

Each source and target subgroup is also an object with the following properties:

* `startAngle` - the start angle in radians
* `endAngle` - the end angle in radians
* `value` - the flow value _matrix_\[_i_]\[_j_]
* `index` - the node index _i_

The chords are typically passed to [d3.ribbon](./#ribbon) to display the network relationships. The returned array includes only chord objects for which the value _matrix_\[_i_]\[_j_] or _matrix_\[_j_]\[_i_] is non-zero. Furthermore, the returned array only contains unique chords: a given chord _ij_ represents the bidirectional flow from _i_ to _j_ _and_ from _j_ to _i_, and does not contain a duplicate chord _ji_; _i_ and _j_ are chosen such that the chord’s source always represents the larger of _matrix_\[_i_]\[_j_] and _matrix_\[_j_]\[_i_].

The _chords_ array also defines a secondary array of length _n_, _chords_.groups, where each group represents the combined outflow for node _i_, corresponding to the elements _matrix_\[_i_]\[0 … _n_ - 1], and is an object with the following properties:

* `startAngle` - the start angle in radians
* `endAngle` - the end angle in radians
* `value` - the total outgoing flow value for node _i_
* `index` - the node index _i_

The groups are typically passed to [d3.arc](https://github.com/d3/d3-shape#arc) to produce a donut chart around the circumference of the chord layout.

[#](./#chord\_padAngle) _chord_.padAngle(\[_angle_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

If _angle_ is specified, sets the pad angle between adjacent groups to the specified number in radians and returns this chord layout. If _angle_ is not specified, returns the current pad angle, which defaults to zero.

[#](./#chord\_sortGroups) _chord_.sortGroups(\[_compare_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

If _compare_ is specified, sets the group comparator to the specified function or null and returns this chord layout. If _compare_ is not specified, returns the current group comparator, which defaults to null. If the group comparator is non-null, it is used to sort the groups by their total outflow. See also [d3.ascending](https://github.com/d3/d3-array/blob/master/README.md#ascending) and [d3.descending](https://github.com/d3/d3-array/blob/master/README.md#descending).

[#](./#chord\_sortSubgroups) _chord_.sortSubgroups(\[_compare_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

If _compare_ is specified, sets the subgroup comparator to the specified function or null and returns this chord layout. If _compare_ is not specified, returns the current subgroup comparator, which defaults to null. If the subgroup comparator is non-null, it is used to sort the subgroups corresponding to _matrix_\[_i_]\[0 … _n_ - 1] for a given group _i_ by their total outflow. See also [d3.ascending](https://github.com/d3/d3-array/blob/master/README.md#ascending) and [d3.descending](https://github.com/d3/d3-array/blob/master/README.md#descending).

[#](./#chord\_sortChords) _chord_.sortChords(\[_compare_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

If _compare_ is specified, sets the chord comparator to the specified function or null and returns this chord layout. If _compare_ is not specified, returns the current chord comparator, which defaults to null. If the chord comparator is non-null, it is used to sort the [chords](./#\_chord) by their combined flow; this only affects the _z_-order of the chords. See also [d3.ascending](https://github.com/d3/d3-array/blob/master/README.md#ascending) and [d3.descending](https://github.com/d3/d3-array/blob/master/README.md#descending).

[#](./#chordDirected) d3.chordDirected() · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js), [Examples](https://observablehq.com/@d3/directed-chord-diagram)

A chord layout for directional flows. The chord from _i_ to _j_ is generated from the value in _matrix_\[_i_]\[_j_] only.

[#](./#chordTranspose) d3.chordTranspose() · [Source](https://github.com/d3/d3-chord/blob/master/src/chord.js)

A transposed chord layout. Useful to highlight outgoing (rather than incoming) flows.

[#](./#ribbon) d3.ribbon() · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

Creates a new ribbon generator with the default settings.

[#](./#\_ribbon) _ribbon_(_arguments…_) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

Generates a ribbon for the given _arguments_. The _arguments_ are arbitrary; they are simply propagated to the ribbon generator’s accessor functions along with the `this` object. For example, with the default settings, a [chord object](./#\_chord) expected:

```js
const ribbon = d3.ribbon();

ribbon({
  source: {startAngle: 0.7524114, endAngle: 1.1212972, radius: 240},
  target: {startAngle: 1.8617078, endAngle: 1.9842927, radius: 240}
}); // "M164.0162810494058,-175.21032946354026A240,240,0,0,1,216.1595644740915,-104.28347273835429Q0,0,229.9158815306728,68.8381247563705A240,240,0,0,1,219.77316791012538,96.43523560788266Q0,0,164.0162810494058,-175.21032946354026Z"
```

Or equivalently if the radius is instead defined as a constant:

```js
const ribbon = d3.ribbon()
    .radius(240);

ribbon({
  source: {startAngle: 0.7524114, endAngle: 1.1212972},
  target: {startAngle: 1.8617078, endAngle: 1.9842927}
}); // "M164.0162810494058,-175.21032946354026A240,240,0,0,1,216.1595644740915,-104.28347273835429Q0,0,229.9158815306728,68.8381247563705A240,240,0,0,1,219.77316791012538,96.43523560788266Q0,0,164.0162810494058,-175.21032946354026Z"
```

If the ribbon generator has a context, then the ribbon is rendered to this context as a sequence of path method calls and this function returns void. Otherwise, a path data string is returned.

[#](./#ribbon\_source) _ribbon_.source(\[_source_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _source_ is specified, sets the source accessor to the specified function and returns this ribbon generator. If _source_ is not specified, returns the current source accessor, which defaults to:

```js
function source(d) {
  return d.source;
}
```

[#](./#ribbon\_target) _ribbon_.target(\[_target_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _target_ is specified, sets the target accessor to the specified function and returns this ribbon generator. If _target_ is not specified, returns the current target accessor, which defaults to:

```js
function target(d) {
  return d.target;
}
```

[#](./#ribbon\_radius) _ribbon_.radius(\[_radius_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _radius_ is specified, sets the source and target radius accessor to the specified function and returns this ribbon generator. If _radius_ is not specified, returns the current source radius accessor, which defaults to:

```js
function radius(d) {
  return d.radius;
}
```

[#](./#ribbon\_sourceRadius) _ribbon_.sourceRadius(\[_radius_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _radius_ is specified, sets the source radius accessor to the specified function and returns this ribbon generator. If _radius_ is not specified, returns the current source radius accessor, which defaults to:

```js
function radius(d) {
  return d.radius;
}
```

[#](./#ribbon\_targetRadius) _ribbon_.targetRadius(\[_radius_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _radius_ is specified, sets the target radius accessor to the specified function and returns this ribbon generator. If _radius_ is not specified, returns the current target radius accessor, which defaults to:

```js
function radius(d) {
  return d.radius;
}
```

By convention, the target radius in asymmetric chord diagrams is typically inset from the source radius, resulting in a gap between the end of the directed link and its associated group arc.

[#](./#ribbon\_startAngle) _ribbon_.startAngle(\[_angle_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _angle_ is specified, sets the start angle accessor to the specified function and returns this ribbon generator. If _angle_ is not specified, returns the current start angle accessor, which defaults to:

```js
function startAngle(d) {
  return d.startAngle;
}
```

The _angle_ is specified in radians, with 0 at -_y_ (12 o’clock) and positive angles proceeding clockwise.

[#](./#ribbon\_endAngle) _ribbon_.endAngle(\[_angle_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _angle_ is specified, sets the end angle accessor to the specified function and returns this ribbon generator. If _angle_ is not specified, returns the current end angle accessor, which defaults to:

```js
function endAngle(d) {
  return d.endAngle;
}
```

The _angle_ is specified in radians, with 0 at -_y_ (12 o’clock) and positive angles proceeding clockwise.

[#](./#ribbon\_padAngle) _ribbon_.padAngle(\[_angle_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _angle_ is specified, sets the pad angle accessor to the specified function and returns this ribbon generator. If _angle_ is not specified, returns the current pad angle accessor, which defaults to:

```js
function padAngle() {
  return 0;
}
```

The pad angle specifies the angular gap between adjacent ribbons.

[#](./#ribbon\_context) _ribbon_.context(\[_context_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _context_ is specified, sets the context and returns this ribbon generator. If _context_ is not specified, returns the current context, which defaults to null. If the context is not null, then the [generated ribbon](./#\_ribbon) is rendered to this context as a sequence of [path method](http://www.w3.org/TR/2dcontext/#canvaspathmethods) calls. Otherwise, a [path data](http://www.w3.org/TR/SVG/paths.html#PathData) string representing the generated ribbon is returned. See also [d3-path](https://github.com/d3/d3-path).

[#](./#ribbonArrow) d3.ribbonArrow() · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

Creates a new arrow ribbon generator with the default settings.

[#](./#ribbonArrow\_headRadius) _ribbonArrow_.headRadius(\[_radius_]) · [Source](https://github.com/d3/d3-chord/blob/master/src/ribbon.js)

If _radius_ is specified, sets the arrowhead radius accessor to the specified function and returns this ribbon generator. If _radius_ is not specified, returns the current arrowhead radius accessor, which defaults to:

```js
function headRadius() {
  return 10;
}
```

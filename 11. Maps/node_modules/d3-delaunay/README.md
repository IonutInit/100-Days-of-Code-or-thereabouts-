# d3-delaunay

![](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/voronator.jpg)

Georgy “The Voronator” Voronoy

This is a fast library for computing the [Voronoi diagram](https://en.wikipedia.org/wiki/Voronoi\_diagram) of a set of two-dimensional points. It is based on [Delaunator](https://github.com/mapbox/delaunator), a fast library for computing the [Delaunay triangulation](https://en.wikipedia.org/wiki/Delaunay\_triangulation) using [sweep algorithms](https://github.com/mapbox/delaunator/blob/master/README.md#papers). The Voronoi diagram is constructed by connecting the circumcenters of adjacent triangles in the Delaunay triangulation.

For an interactive explanation of how this library works, see [The Delaunay’s Dual](https://observablehq.com/@mbostock/the-delaunays-dual).

## Installing

If you use npm, `npm install d3-delaunay`. You can also download the [latest release on GitHub](https://github.com/d3/d3-delaunay/releases/latest). For vanilla HTML in modern browsers, import d3-delaunay from Skypack:

```html
<script type="module">

import {Delaunay} from "https://cdn.skypack.dev/d3-delaunay@6";

const points = [[0, 0], [0, 1], [1, 0], [1, 1]];
const delaunay = Delaunay.from(points);
const voronoi = delaunay.voronoi([0, 0, 960, 500]);

</script>
```

For legacy environments, you can load d3-delaunay’s UMD bundle from an npm-based CDN such as jsDelivr; a `d3` global is exported:

```html
<script src="https://cdn.jsdelivr.net/npm/d3-delaunay@6"></script>
<script>

const delaunay = d3.Delaunay.from(points);

</script>
```

## API Reference

### Delaunay

[#](./#new\_Delaunay) new Delaunay(_points_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the Delaunay triangulation for the given flat array \[_x0_, _y0_, _x1_, _y1_, …] of _points_.

```js
const delaunay = new Delaunay(Float64Array.of(0, 0, 0, 1, 1, 0, 1, 1));
```

[#](./#delaunay\_from) Delaunay.from(_points_\[, _fx_\[, _fy_\[, _that_]]]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the Delaunay triangulation for the given array or iterable of _points_. If _fx_ and _fy_ are not specified, then _points_ is assumed to be an array of two-element arrays of numbers: \[\[_x0_, _y0_], \[_x1_, _y1_], …]. Otherwise, _fx_ and _fy_ are functions that are invoked for each element in the _points_ array in order, and must return the respective _x_- and _y_-coordinate for each point. If _that_ is specified, the functions _fx_ and _fy_ are invoked with _that_ as _this_. (See [Array.from](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global\_Objects/Array/from) for reference.)

```js
const delaunay = Delaunay.from([[0, 0], [0, 1], [1, 0], [1, 1]]);
```

[#](./#delaunay\_points) _delaunay_.points

The coordinates of the points as an array \[_x0_, _y0_, _x1_, _y1_, …]. Typically, this is a Float64Array, however you can use any array-like type in the [constructor](./#new\_Delaunay).

[#](./#delaunay\_halfedges) _delaunay_.halfedges

The halfedge indexes as an Int32Array \[_j0_, _j1_, …]. For each index 0 ≤ _i_ < _halfedges_.length, there is a halfedge from triangle vertex _j_ = _halfedges_\[_i_] to triangle vertex _i_. Equivalently, this means that triangle ⌊_i_ / 3⌋ is adjacent to triangle ⌊_j_ / 3⌋. If _j_ is negative, then triangle ⌊_i_ / 3⌋ is an exterior triangle on the [convex hull](./#delaunay\_hull). For example, to render the internal edges of the Delaunay triangulation:

```js
const {points, halfedges, triangles} = delaunay;
for (let i = 0, n = halfedges.length; i < n; ++i) {
  const j = halfedges[i];
  if (j < i) continue;
  const ti = triangles[i];
  const tj = triangles[j];
  context.moveTo(points[ti * 2], points[ti * 2 + 1]);
  context.lineTo(points[tj * 2], points[tj * 2 + 1]);
}
```

See also [_delaunay_.render](./#delaunay\_render).

[#](./#delaunay\_hull) _delaunay_.hull

An Int32Array of point indexes that form the convex hull in counterclockwise order. If the points are collinear, returns them ordered.

See also [_delaunay_.renderHull](./#delaunay\_renderHull).

[#](./#delaunay\_triangles) _delaunay_.triangles

The triangle vertex indexes as an Uint32Array \[_i0_, _j0_, _k0_, _i1_, _j1_, _k1_, …]. Each contiguous triplet of indexes _i_, _j_, _k_ forms a counterclockwise triangle. The coordinates of the triangle’s points can be found by going through [_delaunay_.points](./#delaunay\_points). For example, to render triangle _i_:

```js
const {points, triangles} = delaunay;
const t0 = triangles[i * 3 + 0];
const t1 = triangles[i * 3 + 1];
const t2 = triangles[i * 3 + 2];
context.moveTo(points[t0 * 2], points[t0 * 2 + 1]);
context.lineTo(points[t1 * 2], points[t1 * 2 + 1]);
context.lineTo(points[t2 * 2], points[t2 * 2 + 1]);
context.closePath();
```

See also [_delaunay_.renderTriangle](./#delaunay\_renderTriangle).

[#](./#delaunay\_inedges) _delaunay_.inedges

The incoming halfedge indexes as a Int32Array \[_e0_, _e1_, _e2_, …]. For each point _i_, _inedges_\[_i_] is the halfedge index _e_ of an incoming halfedge. For coincident points, the halfedge index is -1; for points on the convex hull, the incoming halfedge is on the convex hull; for other points, the choice of incoming halfedge is arbitrary. The _inedges_ table can be used to traverse the Delaunay triangulation; see also [_delaunay_.neighbors](./#delaunay\_neighbors).

[#](./#delaunay\_find) _delaunay_.find(_x_, _y_\[, _i_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the index of the input point that is closest to the specified point ⟨_x_, _y_⟩. The search is started at the specified point _i_. If _i_ is not specified, it defaults to zero.

[#](./#delaunay\_neighbors) _delaunay_.neighbors(_i_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns an iterable over the indexes of the neighboring points to the specified point _i_. The iterable is empty if _i_ is a coincident point.

[#](./#delaunay\_render) _delaunay_.render(\[_context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

![delaunay.render](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/delaunay-mesh.png)

Renders the edges of the Delaunay triangulation to the specified _context_. The specified _context_ must implement the _context_.moveTo and _context_.lineTo methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#delaunay\_renderHull) _delaunay_.renderHull(\[_context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

![delaunay.renderHull](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/delaunay-hull.png)

Renders the convex hull of the Delaunay triangulation to the specified _context_. The specified _context_ must implement the _context_.moveTo and _context_.lineTo methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#delaunay\_renderTriangle) _delaunay_.renderTriangle(_i_\[, _context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

![delaunay.renderTriangle](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/delaunay-triangle.png)

Renders triangle _i_ of the Delaunay triangulation to the specified _context_. The specified _context_ must implement the _context_.moveTo, _context_.lineTo and _context_.closePath methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#delaunay\_renderPoints) _delaunay_.renderPoints(\[_context_]\[, _radius_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Renders the input points of the Delaunay triangulation to the specified _context_ as circles with the specified _radius_. If _radius_ is not specified, it defaults to 2. The specified _context_ must implement the _context_.moveTo and _context_.arc methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#delaunay\_hullPolygon) _delaunay_.hullPolygon() [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the closed polygon \[\[_x0_, _y0_], \[_x1_, _y1_], …, \[_x0_, _y0_]] representing the convex hull.

[#](./#delaunay\_trianglePolygons) _delaunay_.trianglePolygons() [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns an iterable over the [polygons for each triangle](./#delaunay\_trianglePolygon), in order.

[#](./#delaunay\_trianglePolygon) _delaunay_.trianglePolygon(_i_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the closed polygon \[\[_x0_, _y0_], \[_x1_, _y1_], \[_x2_, _y2_], \[_x0_, _y0_]] representing the triangle _i_.

[#](./#delaunay\_update) _delaunay_.update() [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Updates the triangulation after the points have been modified in-place.

[#](./#delaunay\_voronoi) _delaunay_.voronoi(\[_bounds_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/delaunay.js)

Returns the [Voronoi diagram](./#voronoi) for the associated [points](./#delaunay\_points). When rendering, the diagram will be clipped to the specified _bounds_ = \[_xmin_, _ymin_, _xmax_, _ymax_]. If _bounds_ is not specified, it defaults to \[0, 0, 960, 500]. See [To Infinity and Back Again](https://observablehq.com/@mbostock/to-infinity-and-back-again) for an interactive explanation of Voronoi cell clipping.

The Voronoi diagram is returned even in degenerate cases where no triangulation exists — namely 0, 1 or 2 points, and collinear points.

### Voronoi

[#](./#voronoi\_delaunay) _voronoi_.delaunay

The Voronoi diagram’s associated [Delaunay triangulation](./#delaunay).

[#](./#voronoi\_circumcenters) _voronoi_.circumcenters

The [circumcenters](http://mathworld.wolfram.com/Circumcenter.html) of the Delaunay triangles as a Float64Array \[_cx0_, _cy0_, _cx1_, _cy1_, …]. Each contiguous pair of coordinates _cx_, _cy_ is the circumcenter for the corresponding triangle. These circumcenters form the coordinates of the Voronoi cell polygons.

[#](./#voronoi\_vectors) _voronoi_.vectors

A Float64Array \[_vx0_, _vy0_, _wx0_, _wy0_, …] where each non-zero quadruple describes an open (infinite) cell on the outer hull, giving the directions of two open half-lines.

[#](./#voronoi\_xmin) _voronoi_.xmin\
[#](./#voronoi\_ymin) _voronoi_.ymin\
[#](./#voronoi\_xmax) _voronoi_.xmax\
[#](./#voronoi\_ymax) _voronoi_.ymax\


The bounds of the viewport \[_xmin_, _ymin_, _xmax_, _ymax_] for rendering the Voronoi diagram. These values only affect the rendering methods ([_voronoi_.render](./#voronoi\_render), [_voronoi_.renderBounds](./#voronoi\_renderBounds), [_cell_.render](./#cell\_render)).

[#](./#voronoi\_contains) _voronoi_.contains(_i_, _x_, _y_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/cell.js)

Returns true if the cell with the specified index _i_ contains the specified point ⟨_x_, _y_⟩. (This method is not affected by the associated Voronoi diagram’s viewport [bounds](./#voronoi\_xmin).)

[#](./#voronoi\_neighbors) _voronoi_.neighbors(_i_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

Returns an iterable over the indexes of the cells that share a common edge with the specified cell _i_. Voronoi neighbors are always neighbors on the Delaunay graph, but the converse is false when the common edge has been clipped out by the Voronoi diagram’s viewport.

[#](./#voronoi\_render) _voronoi_.render(\[_context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

![voronoi.render](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/voronoi-mesh.png)

Renders the mesh of Voronoi cells to the specified _context_. The specified _context_ must implement the _context_.moveTo and _context_.lineTo methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#voronoi\_renderBounds) _voronoi_.renderBounds(\[_context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

![voronoi.renderBounds](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/voronoi-bounds.png)

Renders the viewport extent to the specified _context_. The specified _context_ must implement the _context_.rect method from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). Equivalent to _context_.rect(_voronoi_.xmin, _voronoi_.ymin, _voronoi_.xmax - _voronoi_.xmin, _voronoi_.ymax - _voronoi_.ymin). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#voronoi\_renderCell) _voronoi_.renderCell(_i_\[, _context_]) [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

![cell.render](https://raw.githubusercontent.com/d3/d3-delaunay/master/img/spectral.png)

Renders the cell with the specified index _i_ to the specified _context_. The specified _context_ must implement the _context_.moveTo , _context_.lineTo and _context_.closePath methods from the [CanvasPathMethods API](https://www.w3.org/TR/2dcontext/#canvaspathmethods). If a _context_ is not specified, an SVG path string is returned instead.

[#](./#voronoi\_cellPolygons) _voronoi_.cellPolygons() [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

Returns an iterable over the non-empty [polygons for each cell](./#voronoi\_cellPolygon), with the cell index as property.

[#](./#voronoi\_cellPolygon) _voronoi_.cellPolygon(_i_) [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

Returns the convex, closed polygon \[\[_x0_, _y0_], \[_x1_, _y1_], …, \[_x0_, _y0_]] representing the cell for the specified point _i_.

[#](./#voronoi\_update) _voronoi_.update() [<>](https://github.com/d3/d3-delaunay/blob/master/src/voronoi.js)

Updates the Voronoi diagram and underlying triangulation after the points have been modified in-place — useful for Lloyd’s relaxation.
